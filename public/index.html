<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>فريق العون الذكي</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tajawal:wght@700;800;900&display=swap" rel="stylesheet" />
  <style>
    :root{--bg:#0d1117;--card:#161b22;--line:#30363d}
    html,body{height:100%}
    body{font-family:'Cairo',sans-serif;background:var(--bg);color:#e5e7eb;line-height:1.6;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overscroll-behavior-y:none}
    h1,h2,h3,h4,h5,h6{font-family:'Tajawal',sans-serif;margin-bottom:1rem}
    p{margin-bottom:1.5rem}
    .text-gradient{background:linear-gradient(90deg,#60a5fa,#8b5cf6,#ec4899);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .hero-section{background:url('https://images.unsplash.com/photo-1516117172878-fd2dc7981503?q=80&w=2070&auto=format&fit=crop') center/cover no-repeat;position:relative;padding:8rem 0;overflow:hidden}
    .hero-overlay{background-color:rgba(13,17,23,.8);position:absolute;inset:0}
    .btn-gradient{background:linear-gradient(90deg,#60a5fa,#8b5cf6);transition:.25s transform,.25s box-shadow;box-shadow:0 4px 10px rgba(0,0,0,.2);position:relative;z-index:1}
    .btn-gradient:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,.35)}
    .robot-card{display:flex;flex-direction:column;align-items:center;text-align:center;background-color:var(--card);padding:1.25rem;border-radius:1rem;border:1px solid var(--line);box-shadow:0 4px 8px rgba(0,0,0,.2);transition:.25s transform,.25s box-shadow;cursor:pointer}
    .robot-card:hover{transform:translateY(-6px);box-shadow:0 14px 22px rgba(0,0,0,.35)}
    .robot-circle{width:112px;height:112px;border-radius:50%;background:linear-gradient(to right,#60a5fa,#8b5cf6);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .robot-image{width:100%;height:100%;object-fit:cover;transition:transform .25s}
    .robot-card:hover .robot-image{transform:scale(1.06)}
    .faq-item{background:var(--card);padding:1.25rem;border-radius:.75rem;border:1px solid var(--line);cursor:pointer;transition:background .25s}
    .faq-item:hover{background:#1b2230}
    .faq-answer{max-height:0;overflow:hidden;transition:max-height .25s}
    .faq-item.active .faq-answer{max-height:220px}
    .discount-badge{background:linear-gradient(90deg,#60a5fa,#8b5cf6,#ec4899);color:#fff;padding:.5rem 1.25rem;border-radius:9999px;font-weight:700;position:absolute;top:-1.25rem;right:-1.25rem;transform:rotate(45deg);box-shadow:0 4px 10px rgba(0,0,0,.2)}
    /* ============ محادثة مثل واتساب ============ */
    #robot-chat-interface{position:fixed;inset:0;display:none;background:var(--bg);z-index:90}
    .chat-header{position:sticky;top:0;background:#111827;border-bottom:1px solid var(--line);padding:.75rem 1rem;z-index:5}
    .chat-title{font-weight:800}
    #robot-chat-messages{
      height:calc(100vh - 58px - env(safe-area-inset-bottom) - 72px);
      overflow-y:auto; padding:12px 12px 0 12px; display:flex; flex-direction:column; gap:.6rem;
      scroll-behavior:smooth; overscroll-behavior:contain; -webkit-overflow-scrolling:touch;
    }
    .bubble{max-width:86%;padding:.6rem .85rem;border-radius:14px;word-wrap:break-word;line-height:1.5}
    .bubble.user{align-self:flex-end;background:#3b82f6;color:#fff;border-bottom-right-radius:6px}
    .bubble.ai{align-self:flex-start;background:#8b5cf6;color:#fff;border-bottom-left-radius:6px}
    .bubble.system{align-self:center;background:#374151;color:#e5e7eb}
    #composer{position:sticky;bottom:0;border-top:1px solid var(--line);background:#0f1623;padding:.5rem .6rem .65rem .6rem;z-index:5}
    .composer-wrap{display:flex;align-items:flex-end;gap:.5rem}
    #robot-chat-input{
      resize:none;min-height:44px;max-height:132px;overflow-y:auto;flex:1;background:#111827;border:1px solid var(--line);
      border-radius:9999px;padding:.7rem 1rem;color:#fff;outline:none
    }
    .send-btn{background:#2563eb;color:#fff;border-radius:9999px;padding:.7rem 1.1rem;font-weight:700}
    .scroll-bottom{position:fixed;right:16px;bottom:88px;background:#374151;border:1px solid var(--line);color:#fff;border-radius:9999px;padding:.45rem .7rem;display:none;z-index:6}
    .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite;display:inline-block}
    @keyframes spin{to{transform:rotate(1turn)}}
    /* iOS fix for input hidden under keyboard */
    @supports (-webkit-touch-callout: none){ #robot-chat-messages{padding-bottom:20px} #composer{padding-bottom:calc(.65rem + env(safe-area-inset-bottom))}}
  </style>
</head>
<body class="antialiased">

  <!-- Header -->
  <header id="main-header" class="p-4 md:p-6 relative z-20">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl md:text-3xl font-extrabold text-white">فريق العون الذكي</h1>
      <div class="flex gap-2">
        <a href="admin.html" id="admin-link" class="btn-gradient text-white px-4 md:px-6 py-2 rounded-full font-semibold hidden">لوحة الأدمن</a>
        <a href="#" id="login-btn" class="btn-gradient text-white px-4 md:px-6 py-2 rounded-full font-semibold">تسجيل الدخول</a>
      </div>
    </div>
  </header>

  <!-- Landing -->
  <main id="main-content">
    <section class="hero-section text-center relative flex items-center justify-center">
      <div class="hero-overlay"></div>
      <div class="container mx-auto px-4 relative z-10 py-16">
        <h2 class="text-5xl md:text-7xl font-extrabold leading-tight mb-4 text-white">
          <span class="text-gradient">أنجز أكثر</span> مع فريق العون الذكي
        </h2>
        <p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-3xl mx-auto">
          نقدم لك فريقاً متخصصاً من 12 مساعداً، كل منهم جاهز لإنجاز مهمة محددة بدقة وكفاءة.
        </p>
        <a href="#" class="btn-gradient text-white text-lg px-8 py-4 rounded-full">ابدأ الآن</a>
      </div>
    </section>

    <!-- Pricing -->
    <section class="py-16 md:py-20 bg-gray-900 text-center">
      <div class="container mx-auto px-4">
        <h3 class="text-3xl md:text-4xl font-bold mb-4 text-white">عرض حصري مدى الحياة</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-8 max-w-2xl mx-auto">
          احصل على وصول كامل وغير محدود إلى جميع المساعدين بسعر استثنائي يدفع لمرة واحدة.
        </p>
        <div class="bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-700 max-w-lg mx-auto relative overflow-hidden">
          <div class="discount-badge">خصم ٩٠%</div>
          <div class="relative z-10 flex flex-col items-center">
            <p class="text-5xl font-extrabold text-white mb-2">
              <span class="text-2xl line-through text-gray-500">200$</span>
              <span class="text-gradient text-6xl">39$</span>
            </p>
            <p class="text-gray-400 mb-6">للوصول مدى الحياة</p>
            <a href="#" class="btn-gradient text-white text-lg px-8 py-4 rounded-full">اشترِ الآن</a>
          </div>
        </div>
      </div>
    </section>

    <!-- What You Get -->
    <section class="py-16 md:py-20">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-3xl md:text-4xl font-bold mb-4 text-white">ما الذي ستحصل عليه؟</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-10 md:mb-12 max-w-3xl mx-auto">مزايا ثابتة مدى الحياة.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
          <div class="bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-700 text-center">
            <svg class="mx-auto" width="48" height="48" fill="currentColor" viewBox="0 0 24 24"><path d="M10 17l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            <h4 class="text-2xl font-bold mb-2 text-white">جميع المساعدين الـ12</h4>
            <p class="text-gray-400">وصول كامل لكل مساعد.</p>
          </div>
          <div class="bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-700 text-center">
            <svg class="mx-auto" width="48" height="48" fill="currentColor" viewBox="0 0 24 24"><path d="M10 17l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            <h4 class="text-2xl font-bold mb-2 text-white">تحديثات مدى الحياة</h4>
            <p class="text-gray-400">تحسينات مستمرة دون رسوم.</p>
          </div>
          <div class="bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-700 text-center">
            <svg class="mx-auto" width="48" height="48" fill="currentColor" viewBox="0 0 24 24"><path d="M10 17l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            <h4 class="text-2xl font-bold text-white">حل متكامل</h4>
            <p class="text-gray-400">كل شيء في مكان واحد.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Why -->
    <section class="py-16 md:py-20 bg-gray-900">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-3xl md:text-4xl font-bold mb-4 text-white">لماذا فريق العون الذكي؟</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-12 max-w-2xl mx-auto">تخصص + سرعة + تكامل.</p>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
          <div class="bg-gray-800 p-8 rounded-xl border border-gray-700"><div class="text-5xl mb-4 text-gradient">✨</div><h4 class="text-2xl font-bold mb-2 text-white">تخصص</h4><p class="text-gray-400">كل مساعد يتقن مجاله.</p></div>
          <div class="bg-gray-800 p-8 rounded-xl border border-gray-700"><div class="text-5xl mb-4 text-gradient">🚀</div><h4 class="text-2xl font-bold mb-2 text-white">سرعة</h4><p class="text-gray-400">إنجاز فوري بذكاء.</p></div>
          <div class="bg-gray-800 p-8 rounded-xl border border-gray-700"><div class="text-5xl mb-4 text-gradient">🔗</div><h4 class="text-2xl font-bold text-white">تكامل</h4><p class="text-gray-400">وداعًا للتبديل بين الأدوات.</p></div>
        </div>
      </div>
    </section>

    <!-- Team -->
    <section class="py-16 md:py-20 bg-gray-900">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-3xl md:text-4xl font-bold mb-4 text-white">تعرف على فريقك</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-10 max-w-3xl mx-auto">12 مساعداً متخصّصاً.</p>
        <div id="robots-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6"></div>
      </div>
    </section>

    <!-- آراء -->
    <section class="py-16 md:py-20">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-3xl md:text-4xl font-bold mb-4 text-white">ماذا يقول عملاؤنا؟</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-12 max-w-2xl mx-auto">قصص نجاح حقيقية.</p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
          <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 text-left"><p class="text-gray-300 mb-4">"أصبحنا أكثر كفاءة وإنتاجية."</p><p class="font-bold text-white">- أحمد</p></div>
          <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 text-left"><p class="text-gray-300 mb-4">"مساعد التسويق وفّر ساعات عمل."</p><p class="font-bold text-white">- سارة</p></div>
          <div class="bg-gray-800 p-8 rounded-xl border border-gray-700 text-left"><p class="text-gray-300 mb-4">"التحليل صار سهلاً."</p><p class="font-bold text-white">- خالد</p></div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="py-16 md:py-20 bg-gray-900">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-3xl md:text-4xl font-bold mb-4 text-white">الأسئلة الشائعة</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-12 max-w-3xl mx-auto">أبرز الأسئلة المتكررة.</p>
        <div class="space-y-4 max-w-3xl mx-auto">
          <div class="faq-item"><div class="flex justify-between items-center"><h5 class="font-bold text-white">هل يمكن استخدام أكثر من مساعد؟</h5><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div><div class="faq-answer mt-3 text-gray-400"><p>نعم، دون حدود.</p></div></div>
          <div class="faq-item"><div class="flex justify-between items-center"><h5 class="font-bold text-white">هل توجد نسخة تجريبية؟</h5><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div><div class="faq-answer mt-3 text-gray-400"><p>الشراء مدى الحياة لمرة واحدة.</p></div></div>
          <div class="faq-item"><div class="flex justify-between items-center"><h5 class="font-bold text-white">تكلفة الاشتراك؟</h5><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div><div class="faq-answer mt-3 text-gray-400"><p>ليست اشتراكاً.</p></div></div>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="py-16 md:py-20 bg-gray-800 text-center">
      <div class="container mx-auto px-4">
        <h3 class="text-3xl md:text-4xl font-bold text-white mb-4">جاهز لتحقيق المزيد؟</h3>
        <p class="text-lg md:text-xl text-gray-400 mb-8">انضم وابدأ الآن.</p>
        <a href="#" class="btn-gradient text-white text-lg px-8 py-4 rounded-full">اشترِ الآن</a>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-center py-6"><p class="text-gray-500">&copy; 2025 فريق العون الذكي.</p></footer>

  <!-- Login Modal -->
  <div id="login-modal" class="fixed inset-0 hidden z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center">
    <div class="bg-[#161b22] w-[92%] max-w-[420px] border border-gray-700 rounded-xl p-6">
      <div class="flex items-center justify-between mb-3">
        <h4 class="text-2xl font-bold text-white">تسجيل الدخول</h4>
        <button class="text-gray-400 hover:text-white" id="close-login">&times;</button>
      </div>
      <div class="mb-4">
        <label class="block text-gray-400 mb-2" for="username">اسم المستخدم</label>
        <input id="username" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-purple-500" placeholder="أدخل اسم المستخدم" />
      </div>
      <div class="mb-5">
        <label class="block text-gray-400 mb-2" for="password">كلمة المرور</label>
        <input id="password" type="password" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-purple-500" placeholder="أدخل كلمة المرور" />
      </div>
      <button id="submit-login" class="btn-gradient w-full text-white py-3 rounded-full font-bold">دخول</button>
      <p id="login-message" class="mt-4 text-center font-bold"></p>
      <p id="admin-health" class="text-xs text-center text-gray-400 mt-3"></p>
    </div>
  </div>

  <!-- Dashboard (مختصر: اختيار الروبوت فقط) -->
  <div id="dashboard-container" class="hidden">
    <header class="p-6">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl md:text-3xl font-extrabold text-white">لوحة التحكم</h1>
        <div class="flex gap-2">
          <a href="admin.html" id="dash-admin-link" class="btn-gradient text-white px-4 py-2 rounded-full font-semibold hidden">لوحة الأدمن</a>
          <a href="#" id="profile-btn" class="btn-gradient text-white px-4 py-2 rounded-full font-semibold">الملف الشخصي</a>
          <a href="#" id="logout-btn" class="btn-gradient text-white px-4 py-2 rounded-full font-semibold">خروج</a>
        </div>
      </div>
    </header>

    <section class="py-8">
      <div class="container mx-auto px-4 text-center">
        <h3 class="text-3xl font-bold mb-3 text-white">اختر مساعدك</h3>
        <p class="text-lg text-gray-400 mb-8 max-w-3xl mx-auto">ابدأ محادثة مع أي مساعد.</p>
        <div id="robot-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6"></div>
      </div>
    </section>

    <section class="py-10 bg-gray-900">
      <div class="container mx-auto px-4">
        <h3 class="text-3xl font-bold mb-4 text-white text-center">محادثاتك السابقة</h3>
        <div id="conversations-list" class="space-y-3"></div>
      </div>
    </section>
  </div>

  <!-- Profile (مختصر) -->
  <div id="profile-section" class="hidden fixed inset-0 bg-[#0d1117] z-[90] flex-col overflow-y-auto">
    <div class="flex items-center justify-between p-4 bg-gray-800 border-b border-gray-700">
      <button id="back-to-dashboard-from-profile-btn" class="text-white text-2xl">&larr;</button>
      <h4 class="text-xl font-bold text-white">الملف الشخصي</h4><span class="w-6 h-6"></span>
    </div>
    <div class="container mx-auto px-4 py-8">
      <h3 class="text-2xl md:text-3xl font-bold text-white mb-4">بياناتي الأساسية</h3>
      <div id="basic-data" class="bg-gray-800 p-6 rounded-lg mb-6 border border-gray-700"></div>
      <h3 class="text-2xl md:text-3xl font-bold text-white mb-4">ما تعلمه الذكاء الاصطناعي</h3>
      <div id="learned-data" class="bg-gray-800 p-6 rounded-lg border border-gray-700">
        <p class="text-gray-400">لا توجد معلومات إضافية حتى الآن.</p>
      </div>
    </div>
  </div>

  <!-- Chat like WhatsApp -->
  <div id="robot-chat-interface">
    <div class="chat-header flex items-center gap-2">
      <button id="back-to-dashboard-btn" class="text-white text-2xl">&larr;</button>
      <h4 id="robot-chat-header" class="chat-title text-white text-lg md:text-xl mx-auto"></h4>
      <span class="w-6 h-6"></span>
    </div>
    <div id="robot-chat-messages"></div>
    <button id="scroll-bottom" class="scroll-bottom">للأسفل</button>
    <div id="composer">
      <div class="composer-wrap">
        <label for="file-upload" class="cursor-pointer shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-gray-400 hover:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
          <input type="file" id="file-upload" class="hidden" />
        </label>
        <textarea id="robot-chat-input" placeholder="اكتب رسالتك هنا..." rows="1"></textarea>
        <button id="robot-chat-send-btn" class="send-btn">إرسال</button>
      </div>
    </div>
  </div>

  <script>
    /* ---------- بيانات الروبوتات مع صور دقيقة ---------- */
    const robots = [
      { name:"ألفا (Alfa)", specialization:"مساعد التسويق الرقمي", img:"https://images.unsplash.com/photo-1551281044-3ca5df2abf36?q=80&w=900&auto=format&fit=crop" },
      { name:"فيزي (Vizi)", specialization:"مساعد المبيعات", img:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=900&auto=format&fit=crop" },
      { name:"كورتكس (Cortex)", specialization:"مساعد مالي", img:"https://images.unsplash.com/photo-1554224155-6726b3ff858f?q=80&w=900&auto=format&fit=crop" },
      { name:"ليكس (Lex)", specialization:"مساعد خدمة العملاء", img:"https://images.unsplash.com/photo-1525182008055-f88b95ff7980?q=80&w=900&auto=format&fit=crop" },
      { name:"أوكتو (Octo)", specialization:"مساعد العمليات", img:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=900&auto=format&fit=crop" },
      { name:"مينا (Mina)", specialization:"مساعد تحليل البيانات", img:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=900&auto=format&fit=crop" },
      { name:"بولت (Bolt)", specialization:"مساعد إدارة المشاريع", img:"https://images.unsplash.com/photo-1552581234-26160f608093?q=80&w=900&auto=format&fit=crop" },
      { name:"ريكس (Rex)", specialization:"مساعد الإدارة المالية", img:"https://images.unsplash.com/photo-1553729784-e91953dec042?q=80&w=900&auto=format&fit=crop" },
      { name:"بادي (Buddy)", specialization:"مساعد العلاقات العامة", img:"https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=900&auto=format&fit=crop" },
      { name:"روفر (Rover)", specialization:"مساعد علاقات العملاء", img:"https://images.unsplash.com/photo-1521737604893-ff8a0b6a9d4f?q=80&w=900&auto=format&fit=crop" },
      { name:"فالور (Valor)", specialization:"مساعد التجارة الإلكترونية", img:"https://images.unsplash.com/photo-1522199710521-72d69614c702?q=80&w=900&auto=format&fit=crop" },
      { name:"زينيث (Zenith)", specialization:"مساعد الابتكار", img:"https://images.unsplash.com/photo-1531297484001-80022131f5a1?q=80&w=900&auto=format&fit=crop" }
    ];

    /* ---------- FAQ toggle ---------- */
    document.querySelectorAll('.faq-item').forEach(it=>it.addEventListener('click',()=>it.classList.toggle('active')));

    /* ---------- عناصر عامة ---------- */
    const loginBtn=document.getElementById('login-btn');
    const loginModal=document.getElementById('login-modal');
    const closeLogin=document.getElementById('close-login');
    const submitLogin=document.getElementById('submit-login');
    const usernameInput=document.getElementById('username');
    const passwordInput=document.getElementById('password');
    const loginMessage=document.getElementById('login-message');
    const adminHealth=document.getElementById('admin-health');
    const mainContent=document.getElementById('main-content');
    const mainHeader=document.getElementById('main-header');
    const adminLink=document.getElementById('admin-link');
    const dashAdminLink=document.getElementById('dash-admin-link');

    const dashboardContainer=document.getElementById('dashboard-container');
    const robotListContainer=document.getElementById('robot-list');
    const conversationsListContainer=document.getElementById('conversations-list');
    const profileBtn=document.getElementById('profile-btn');
    const logoutBtn=document.getElementById('logout-btn');

    const profileSection=document.getElementById('profile-section');
    const backToDashboardFromProfileBtn=document.getElementById('back-to-dashboard-from-profile-btn');
    const basicDataContainer=document.getElementById('basic-data');
    const learnedDataContainer=document.getElementById('learned-data');

    const robotsGrid=document.getElementById('robots-grid');

    const robotChatInterface=document.getElementById('robot-chat-interface');
    const robotChatHeader=document.getElementById('robot-chat-header');
    const messagesEl=document.getElementById('robot-chat-messages');
    const inputEl=document.getElementById('robot-chat-input');
    const sendBtn=document.getElementById('robot-chat-send-btn');
    const backBtn=document.getElementById('back-to-dashboard-btn');
    const fileUploadInput=document.getElementById('file-upload');
    const scrollBottomBtn=document.getElementById('scroll-bottom');

    let setupChatState=0; let companyData={}; let currentRobot=null; let aiLearnedData=JSON.parse(localStorage.getItem('aiLearnedData')||'{}');

    /* ---------- رندر شبكة الروبوتات في اللاندنج أيضًا ---------- */
    function renderRobotsGrid(){
      robotsGrid.innerHTML='';
      robots.forEach(r=>{
        const card=document.createElement('div');
        card.className='robot-card';
        card.innerHTML=`<div class="robot-circle"><img class="robot-image" src="${r.img}" alt="روبوت ${r.name}"/></div>
                        <h4 class="font-bold mt-3 text-white">${r.name}</h4>
                        <p class="text-sm text-gray-400 mt-1">${r.specialization}</p>`;
        card.addEventListener('click',()=>{ showDashboard(); startRobotChat(r.name) });
        robotsGrid.appendChild(card);
      });
    }
    renderRobotsGrid();

    /* ---------- هيلبرز ---------- */
    function addMessage(el, text, sender='ai'){
      const div=document.createElement('div');
      div.className=`bubble ${sender==='user'?'user':sender==='system'?'system':'ai'}`;
      div.textContent=text; el.appendChild(div); autoScroll();
    }
    function addTyping(){
      const div=document.createElement('div'); div.className='bubble ai'; div.innerHTML='<span class="spinner"></span>';
      div.dataset.typing='1'; messagesEl.appendChild(div); autoScroll(); return div;
    }
    function removeTyping(node){ if(node && node.parentNode){ node.parentNode.removeChild(node); } }
    function autoScroll(force=false){
      const near=messagesEl.scrollHeight - messagesEl.scrollTop - messagesEl.clientHeight;
      if(force || near<120){ messagesEl.scrollTop=messagesEl.scrollHeight; scrollBottomBtn.style.display='none'; }
      else{ scrollBottomBtn.style.display='block'; }
    }
    messagesEl.addEventListener('scroll',()=>{
      const near=messagesEl.scrollHeight - messagesEl.scrollTop - messagesEl.clientHeight;
      scrollBottomBtn.style.display = near>120 ? 'block':'none';
    });
    scrollBottomBtn.addEventListener('click',()=>autoScroll(true));

    // textarea auto-grow + iOS fix
    function fitTextarea(){
      inputEl.style.height='auto';
      inputEl.style.height=Math.min(inputEl.scrollHeight,132)+'px';
    }
    inputEl.addEventListener('input',fitTextarea);
    inputEl.addEventListener('focus',()=>setTimeout(()=>inputEl.scrollIntoView({block:'nearest'}),100));

    /* ---------- تسجيل الدخول + ربط الأدمن ---------- */
    loginBtn.addEventListener('click',e=>{e.preventDefault(); loginModal.classList.remove('hidden'); checkAdminHealth();});
    document.getElementById('close-login').addEventListener('click',()=>loginModal.classList.add('hidden'));
    window.addEventListener('click',e=>{ if(e.target===loginModal) loginModal.classList.add('hidden'); });

    async function checkAdminHealth(){
      adminHealth.textContent='يتحقق من خدمة الإدارة…';
      try{
        const r=await fetch('/.netlify/functions/users',{method:'OPTIONS'});
        adminHealth.textContent= r.ok? 'خدمة الإدارة متاحة.':'تعذر الوصول لدالة الإدارة.';
      }catch(_){ adminHealth.textContent='تعذر الوصول لدالة الإدارة.'; }
    }

    submitLogin.addEventListener('click',()=>{
      const u=usernameInput.value.trim(); const p=passwordInput.value.trim();
      if(u==='Aiagent' && p==='2222'){
        loginMessage.textContent='تم تسجيل الدخول بنجاح!'; loginMessage.style.color='#10b981';
        localStorage.setItem('adminSession', JSON.stringify({user:u, ts:Date.now()}));
        adminLink.classList.remove('hidden'); dashAdminLink.classList.remove('hidden');
        setTimeout(()=>{ loginModal.classList.add('hidden'); if(localStorage.getItem('companyData')) showDashboard(); },900);
      }else{ loginMessage.textContent='بيانات الدخول غير صحيحة.'; loginMessage.style.color='#ef4444'; }
    });

    logoutBtn.addEventListener('click',e=>{
      e.preventDefault(); localStorage.removeItem('adminSession');
      adminLink.classList.add('hidden'); dashAdminLink.classList.add('hidden');
      location.href='/';
    });

    /* ---------- لوحة تحكم بسيطة ---------- */
    function showDashboard(){
      mainContent.classList.add('hidden'); dashboardContainer.classList.remove('hidden'); mainHeader.classList.remove('hidden');
      renderRobotList(); renderConversationsList();
      const sess=localStorage.getItem('adminSession'); if(sess){ adminLink.classList.remove('hidden'); dashAdminLink.classList.remove('hidden'); }
    }
    function renderRobotList(){
      robotListContainer.innerHTML='';
      robots.forEach(robot=>{
        const card=document.createElement('div');
        card.className='robot-card'; card.dataset.name=robot.name;
        card.innerHTML=`<div class="robot-circle"><img src="${robot.img}" class="robot-image" alt="${robot.name}"/></div>
                        <h4 class="font-bold mt-3 text-white">${robot.name}</h4>
                        <p class="text-sm text-gray-400 mt-1">${robot.specialization}</p>`;
        card.addEventListener('click',()=>startRobotChat(robot.name));
        robotListContainer.appendChild(card);
      });
    }
    function renderConversationsList(){
      conversationsListContainer.innerHTML='';
      robots.forEach(robot=>{
        const conv=JSON.parse(localStorage.getItem('conversation_'+robot.name)||'[]');
        if(conv.length){
          const li=document.createElement('div');
          li.className='bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors';
          li.textContent=`محادثة سابقة مع ${robot.name}`;
          li.addEventListener('click',()=>startRobotChat(robot.name));
          conversationsListContainer.appendChild(li);
        }
      });
    }

    profileBtn.addEventListener('click',e=>{e.preventDefault(); dashboardContainer.classList.add('hidden'); profileSection.classList.remove('hidden'); updateProfileSection();});
    backToDashboardFromProfileBtn.addEventListener('click',()=>{ profileSection.classList.add('hidden'); dashboardContainer.classList.remove('hidden'); });
    function updateProfileSection(){
      const basic=JSON.parse(localStorage.getItem('companyData')||'{}'); const learned=JSON.parse(localStorage.getItem('aiLearnedData')||'{}');
      basicDataContainer.innerHTML=`<p class="text-gray-300"><b>اسم الشركة:</b> ${basic.name||'غير متوفر'}</p>
        <p class="text-gray-300"><b>مجال العمل:</b> ${basic.industry||'غير متوفر'}</p>
        <p class="text-gray-300"><b>الأهداف:</b> ${basic.goals||'غير متوفر'}</p>`;
      const keys=Object.keys(learned); learnedDataContainer.innerHTML = keys.length? keys.map(k=>`<p class="text-gray-300"><b>${k}:</b> ${learned[k]}</p>`).join(''): '<p class="text-gray-400">لا توجد معلومات إضافية.</p>';
    }

    /* ---------- برومبتات بدء عبقرية لكل روبوت ---------- */
    const personaHints={
      "ألفا (Alfa)":"إستراتيجية تسويق كاملة: ICP، رسائل قيمة، خارطة قنوات، 3 حملات A/B، تقويم محتوى أسبوعين، مقاييس تتبع.",
      "فيزي (Vizi)":"Playbook مبيعات: أسئلة اكتشاف، معالجة الاعتراضات، قوالب بريد/واتساب، مؤشرات CRM، خطة 14 يومًا لإغلاق صفقات.",
      "كورتكس (Cortex)":"لوحة قيادة مالية: ميزانية مبسطة، توقع تدفق نقدي، هوامش ربح، توصيات تسعير، إجراءات خفض تكلفة.",
      "ليكس (Lex)":"SLA خدمة عملاء، تصعيد حالات، قوالب ردود متعددة اللهجات، خطة تحسين CSAT.",
      "أوكتو (Octo)":"SOP تفصيلي لعملية حرجة، مخطط سير عمل، أتمتة مقترحة وأدوات.",
      "مينا (Mina)":"أسئلة فرضيات + مؤشرات رئيسية + خطة تنظيف بيانات + مخطط لوحة تفاعلية.",
      "بولت (Bolt)":"WBS + مخطط جانت مبسّط + مخاطر رئيسية + جدول تسليمات أسبوعي.",
      "ريكس (Rex)":"موازنة أقسام + سياسات صرف + حارس تكاليف + فرص توفير سريعة.",
      "بادي (Buddy)":"حزمة محتوى: بيان صحفي، 5 تغريدات، نص قصة، قائمة مؤثرين، خطة نشر أسبوع.",
      "روفر (Rover)":"تقسيم شرائح + رحلات عميل آلية + عروض ولاء + مؤشرات رضا.",
      "فالور (Valor)":"تشخيص صفحات المنتج + خطة CRO + اختبارات A/B للسلة والدفع.",
      "زينيث (Zenith)":"قماش نموذج عمل + أفكار MVP + خريطة طريق 60 يومًا + منافسين."
    };

    const robotPrompts = Object.fromEntries(robots.map(r=>[r.name,[
      {role:'ai',text:`مرحبًا! أنا ${r.name.split(' ')[0]}. أخبرني بأقوى 3 معلومات: منتجك/خدمتك، جمهورك، وهدفك خلال 30 يومًا.`},
      {role:'ai',text:`سأبني خطة مخصصة الآن. ${personaHints[r.name] || ''} هل تريد التركيز على السوق المحلي أم التوسّع؟`},
      {role:'ai',text:'أرسل لي أي ملفات/روابط تفيد (صفحة منتج، موقع، قائمة أسعار).'}
    ]]));

    /* ---------- محادثة ---------- */
    function startRobotChat(robotName){
      currentRobot=robotName; dashboardContainer.classList.add('hidden'); robotChatInterface.style.display='block';
      robotChatHeader.textContent=`محادثة مع ${robotName}`; messagesEl.innerHTML='';
      const saved=JSON.parse(localStorage.getItem('conversation_'+robotName)||'[]');
      if(saved.length){ saved.forEach(m=>addMessage(messagesEl,m.text,m.sender)); autoScroll(true); }
      else{ (robotPrompts[robotName]||[]).slice(0,1).forEach(m=>addMessage(messagesEl,m.text,'ai')); }
      fitTextarea(); inputEl.focus();
    }

    backBtn.addEventListener('click',()=>{ robotChatInterface.style.display='none'; dashboardContainer.classList.remove('hidden'); mainHeader.classList.remove('hidden'); renderConversationsList(); });

    fileUploadInput.addEventListener('change',e=>{
      const f=e.target.files[0]; if(!f) return;
      addMessage(messagesEl,`تم تحميل الملف: ${f.name}. جاري تحليله…`,'user');
      setTimeout(()=>{
        const ai=`تم تحليل ${f.name}. ما السؤال الذي تريدني أجاوبه انطلاقًا منه؟`;
        addMessage(messagesEl,ai,'ai');
        const conv=JSON.parse(localStorage.getItem('conversation_'+currentRobot)||'[]');
        conv.push({text:`تم رفع ملف: ${f.name}`,sender:'user'},{text:ai,sender:'ai'});
        localStorage.setItem('conversation_'+currentRobot,JSON.stringify(conv));
      },900);
    });

    /* ---------- Gemini Bridge ---------- */
    const NETLIFY_CHAT_ENDPOINT='/.netlify/functions/chat';
    function currentPersona(){ return typeof currentRobot==='string'? currentRobot : '' }
    function recentConversationFor(robotName,limit=14){
      const conv=JSON.parse(localStorage.getItem('conversation_'+robotName)||'[]');
      return conv.slice(-limit).map(m=>({role:m.sender==='user'?'user':'assistant',text:m.text}));
    }
    function withTimeout(p,ms=25000){ const t=new Promise((_,rej)=>setTimeout(()=>rej(new Error('timeout')),ms)); return Promise.race([p,t]); }

    async function geminiReply(userText,persona=''){
      const company=JSON.parse(localStorage.getItem('companyData')||'{}');
      const history=recentConversationFor(currentRobot||persona);
      const body={messages:[...history,{role:'user',text:userText}], persona, company};
      const res=await withTimeout(fetch(NETLIFY_CHAT_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}));
      if(!res.ok){ const t=await res.text(); throw new Error(`HTTP ${res.status} - ${t}`); }
      const data=await res.json(); return data?.text || 'لم يصل رد.';
    }

    async function sendMessage(){
      const userText=inputEl.value.trim(); if(!userText || !currentRobot) return;
      inputEl.value=''; fitTextarea();
      addMessage(messagesEl,userText,'user');
      const storeKey='conversation_'+currentRobot;
      const saved=JSON.parse(localStorage.getItem(storeKey)||'[]'); saved.push({text:userText,sender:'user'});

      const typing=addTyping();
      try{
        const reply=await geminiReply(userText,currentPersona());
        removeTyping(typing); addMessage(messagesEl,reply,'ai');
        saved.push({text:reply,sender:'ai'}); localStorage.setItem(storeKey,JSON.stringify(saved));
      }catch(err){
        removeTyping(typing);
        const fb=`⚠️ تعذّر الاتصال بالذكاء الاصطناعي:\n${err.message}`;
        addMessage(messagesEl,fb,'ai'); saved.push({text:fb,sender:'ai'}); localStorage.setItem(storeKey,JSON.stringify(saved));
      }
    }
    sendBtn.addEventListener('click',sendMessage);
    inputEl.addEventListener('keydown',e=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
    });

    /* ---------- تفعيل لوحة الأدمن إن وُجدت جلسة ---------- */
    document.addEventListener('DOMContentLoaded',()=>{
      if(localStorage.getItem('companyData')){ mainContent.classList.add('hidden'); dashboardContainer.classList.remove('hidden'); renderRobotList(); renderConversationsList(); }
      const sess=localStorage.getItem('adminSession'); if(sess){ adminLink.classList.remove('hidden'); dashAdminLink.classList.remove('hidden'); }
    });

    /* ---------- أدوات بسيطة للإعداد (نفس منطقك القديم محفوظ) ---------- */
    // بإمكانك لاحقًا إعادة واجهة الإعداد إن رغبت؛ تم تبسيطها هنا لعدم إطالة الملف.
  </script>
  <script src="auth-bridge-global.js"></script>
</body>
</html>
